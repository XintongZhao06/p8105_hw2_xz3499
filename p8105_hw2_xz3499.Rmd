---
title: "p8105_hw2_xz3499"
author: "Xintong Zhao"
date: "`r Sys.Date()`"
output: github_document
---

## Problem 1

### 1. Load required libraries
```{r, message=FALSE}
library(tidyverse)
library(lubridate)
```

### 2. Load the dataset
```{r, message=FALSE}
pols_month <- read_csv("fivethirtyeight_datasets/pols-month.csv")
snp <- read_csv("fivethirtyeight_datasets/snp.csv")
unemployment <- read_csv("fivethirtyeight_datasets/unemployment.csv")
```

### 3. Clean the data in pols-month.csv
```{r}
# quickly view the data
glimpse(pols_month)

pols_clean <- pols_month %>% 
  separate(mon, 
           into = c("year","month","day"),
           sep = "-"
           ) %>% 
  mutate(
    month = as.numeric(month),
    month = month.name[month],
    year = as.numeric(year),
    day = as.numeric(day)
  ) %>% 
  mutate(president = ifelse(prez_gop == 1, "gop", "dem")) %>% 
  select(-prez_gop, -prez_dem, -day)

view(pols_clean)
```

### 4. Clean the data in snp.csv
```{r}
# quickly view the data
glimpse(snp)

snp_clean <-snp %>% 
  separate(date, 
           into = c("month","day","year"),
           sep = "/"
           ) %>% 
  mutate(
    month = as.numeric(month),
    month = month.name[month],
    year = as.numeric(year),
    year = ifelse(year < 50, 2000 + year, 1900 + year),
    day = as.numeric(day)
  ) %>% 
  select(year, month, close) %>% 
  arrange(year, month)
  
view(snp_clean)
```

### 5. Tidy the unemployment data
```{r}
unemployment_clean <- unemployment %>% 
  pivot_longer(
    cols = Jan : Dec,
    names_to = "month",
    values_to = "unemployment_rate"
  ) %>% 
  mutate(
    month = case_when(
      month == "Jan" ~ "January",
      month == "Feb" ~ "February",
      month == "Mar" ~ "March",
      month == "Apr" ~ "April",
      month == "May" ~ "May",
      month == "Jun" ~ "June",
      month == "Jul" ~ "July",
      month == "Aug" ~ "August",
      month == "Sep" ~ "September",
      month == "Oct" ~ "October",
      month == "Nov" ~ "November",
      month == "Dec" ~ "December"
    )
  ) %>% 
  select(year = Year, month, unemployment_rate) %>% 
  arrange(year, month)

view(unemployment_clean)
```

### 6. Join the datasets
```{r}
merged_data <- left_join(pols_clean, snp_clean, by = c("year","month"))
final_data <- left_join(merged_data, unemployment_clean, by= c("year","month"))

view(final_data)
```

### 7. Description

* The **"pols_clean"** dataset contains monthly data related to American politics, spanning from 1947 to 2015, with a total of 822 rows of observational data. It specifically includes the number of Democratic and Republican politicians (including governors, senators and representatives) at different times, as well as the party information of the president. The key variables include the number of Republican governors (`gov_gop`), the number of Republican senators (`sen_gop`), the number of Republican representatives (`rep_gop`), the number of Democratic governors (`gov_dem`), the number of Democratic senators (`sen_dem`), the number of Democratic representatives (`rep_dem`), and the presidential party (`president`).

* The **"snp_clean"** dataset contains monthly closing price data of the S&P index, spanning from 1950 to 2015, with a total of 787 rows of observational data. The key variable is the closing price (`close`).

* The **"unemployment_clean"** dataset contains monthly unemployment rate data in the United States, spanning from 1948 to 2015, with a total of 816 rows of observational data. The key variable is the unemployment rate (`unemployment_rate`).

* **"final_data"** contains all the information of the above three datasets, including 11 variables and 822 rows of observational data, spanning from 1947 to 2015. It provides a reference basis for analyzing the historical development of the United States from three dimensions: politics, economy, and employment. Due to the inconsistent time spans of various datasets, there are some missing values after merging.

## Problem 2
